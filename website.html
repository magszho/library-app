<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Room Reservation System - Date Picker Style</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React MUST load BEFORE ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel for on-the-fly JSX transform -->
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

  <!-- Small CSS override for date input -->
  <style>
    /* Force black text for the visible (month, day, year) parts in Chrome-like browsers */
    input[type="date"] {
      color-scheme: light; /* Ensures it doesn't switch to a "dark" scheme internally */
      color: black;        /* Fallback for general text */
    }
    /* Force each part of the date to be black */
    input[type="date"]::-webkit-datetime-edit {
      color: black;
    }
    input[type="date"]::-webkit-datetime-edit-text,
    input[type="date"]::-webkit-datetime-edit-month-field,
    input[type="date"]::-webkit-datetime-edit-day-field,
    input[type="date"]::-webkit-datetime-edit-year-field {
      color: black !important;
    }

    /* We do NOT override the "disabled" or "out of range" color, 
       so invalid dates still appear grayed. */
    /* The user won't be able to select them anyway due to `min` and `max`. */
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
  const { useState, useEffect } = React;

  // --- Date Helpers ---

  // Parse "YYYY-MM-DD" as local date (avoids UTC shift bug).
  function parseLocalDate(dateStr) {
    const [year, month, day] = dateStr.split('-').map(Number);
    return new Date(year, month - 1, day);
  }

  // Return today's date in "YYYY-MM-DD" (local midnight).
  function getTodayStr() {
    const now = new Date();
    now.setHours(0, 0, 0, 0);
    return now.toISOString().split('T')[0];
  }

  // Return Sunday of the current week (used for weekly calendar).
  function getStartOfWeek(date = new Date()) {
    const d = new Date(date);
    const dayOfWeek = d.getDay(); // 0=Sun, 1=Mon, ...
    d.setDate(d.getDate() - dayOfWeek);
    d.setHours(0, 0, 0, 0);
    return d;
  }

  // Generate 7 days from a "week start" (Sun->Sat).
  function getWeekDates(weekStart) {
    const dates = [];
    for (let i = 0; i < 7; i++) {
      const d = new Date(weekStart);
      d.setDate(d.getDate() + i);
      dates.push(d);
    }
    return dates;
  }

  // Format day-of-week header (e.g., "Sun 1/22").
  function formatDayHeader(dateObj) {
    const dow = dateObj.toLocaleString('en-US', { weekday: 'short' });
    const month = dateObj.getMonth() + 1;
    const day = dateObj.getDate();
    return `${dow} ${month}/${day}`;
  }

  // Format the "week start" for display (e.g., "Jan 22, 2025").
  function formatWeekStart(dateObj) {
    return dateObj.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric'
    });
  }

  function ConferenceRoomSystem() {
    // Tabs
    const [activeTab, setActiveTab] = useState('rooms');

    // Reservations (localStorage)
    const [reservations, setReservations] = useState([]);

    // Booking form data
    const [formData, setFormData] = useState({
      room: '',
      date: '',
      period: '1',
      name: '',
      email: '',
      people: '1'
    });

    // Notification
    const [notification, setNotification] = useState(null);

    // Weekly Calendar
    const [currentWeekStart, setCurrentWeekStart] = useState(getStartOfWeek());

    // Constants
    const rooms = ['A', 'B', 'C', 'D'];
    const periods = Array.from({ length: 8 }, (_, i) => (i + 1).toString());

    // Date constraints
    const todayStr = getTodayStr();
    const todayObj = parseLocalDate(todayStr);
    const maxDateObj = new Date(todayObj);
    maxDateObj.setDate(maxDateObj.getDate() + 10); // 10 days in future
    const maxDateStr = maxDateObj.toISOString().split('T')[0];

    // Load from localStorage
    useEffect(() => {
      const stored = localStorage.getItem('reservations');
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (Array.isArray(parsed)) {
            setReservations(parsed);
          }
        } catch (err) {
          console.error('Failed to parse stored reservations:', err);
        }
      }
    }, []);

    // Save whenever reservations change
    useEffect(() => {
      localStorage.setItem('reservations', JSON.stringify(reservations));
    }, [reservations]);

    function showNotification(message, type = 'success') {
      setNotification({ message, type });
      setTimeout(() => setNotification(null), 5000);
    }

    function handleChange(field, value) {
      setFormData(prev => ({ ...prev, [field]: value }));
    }

    function handleSubmit(e) {
      e.preventDefault();
      const cleanedData = {
        room: formData.room.trim(),
        date: formData.date.trim(),
        period: formData.period.trim(),
        name: formData.name.trim(),
        email: formData.email.trim().toLowerCase(),
        people: formData.people.trim()
      };

      // Validate
      if (Object.values(cleanedData).some(v => !v)) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      if (!cleanedData.email.endsWith('@rpsnj.us')) {
        showNotification('Please use an @rpsnj.us email address', 'error');
        return;
      }

      // Date constraints
      const chosenDate = parseLocalDate(cleanedData.date);
      if (chosenDate < todayObj) {
        showNotification('You cannot book a past date', 'error');
        return;
      }
      if (chosenDate > maxDateObj) {
        showNotification('You can only book up to 10 days in advance', 'error');
        return;
      }

      // Double booking check
      const isBooked = reservations.some(
        r => 
          r.room === cleanedData.room &&
          r.date === cleanedData.date &&
          r.period === cleanedData.period
      );
      if (isBooked) {
        showNotification('That room is already booked for the chosen date/period', 'error');
        return;
      }

      // Add reservation with checkIn default to "Pending"
      const newRes = { 
        ...cleanedData, 
        id: Date.now(), 
        checkedIn: 'Pending'
      };
      setReservations(prev => [...prev, newRes]);

      // Reset
      setFormData({
        room: '',
        date: '',
        period: '1',
        name: '',
        email: '',
        people: '1'
      });

      showNotification('Reservation successful! Arrive within 10 minutes of period start.');
    }

    function cancelReservation(id) {
      setReservations(prev => prev.filter(r => r.id !== id));
      showNotification('Reservation cancelled successfully', 'success');
    }

    function myReservations() {
      return reservations
        .filter(r => r.email === formData.email.trim().toLowerCase())
        .sort((a, b) => parseLocalDate(a.date) - parseLocalDate(b.date));
    }

    function getRoomReservationsToday(room) {
      return reservations
        .filter(r => r.room === room && r.date === todayStr)
        .sort((a, b) => parseInt(a.period, 10) - parseInt(b.period, 10));
    }

    // Calendar
    function prevWeek() {
      const newStart = new Date(currentWeekStart);
      newStart.setDate(newStart.getDate() - 7);
      setCurrentWeekStart(newStart);
    }
    function nextWeek() {
      const newStart = new Date(currentWeekStart);
      newStart.setDate(newStart.getDate() + 7);
      setCurrentWeekStart(newStart);
    }
    const weekDates = getWeekDates(currentWeekStart);

    function getReservationsForDayAndPeriod(dayDate, period) {
      const dayStr = dayDate.toISOString().split('T')[0];
      return reservations.filter(r => r.date === dayStr && r.period === period);
    }

    // Maroon button style
    function getPrimaryButtonStyle() {
      return 'bg-[#800000] hover:bg-[#700000] text-white';
    }

    return (
      <div className="min-h-screen bg-gray-100 text-gray-900">
        <div className="p-6 max-w-6xl mx-auto">
          <h1 className="text-2xl font-bold mb-4">Room Reservation System</h1>

          {/* Tabs */}
          <div className="mb-8 border-b border-gray-200">
            <nav className="flex space-x-4" aria-label="Tabs">
              <button
                onClick={() => setActiveTab('rooms')}
                className={`px-3 py-2 text-sm font-medium ${
                  activeTab === 'rooms'
                    ? 'border-b-2 border-[#800000] text-[#800000]'
                    : 'hover:text-gray-700'
                }`}
              >
                Room Availability
              </button>
              <button
                onClick={() => setActiveTab('myreservations')}
                className={`px-3 py-2 text-sm font-medium ${
                  activeTab === 'myreservations'
                    ? 'border-b-2 border-[#800000] text-[#800000]'
                    : 'hover:text-gray-700'
                }`}
              >
                My Reservations
              </button>
              <button
                onClick={() => setActiveTab('calendar')}
                className={`px-3 py-2 text-sm font-medium ${
                  activeTab === 'calendar'
                    ? 'border-b-2 border-[#800000] text-[#800000]'
                    : 'hover:text-gray-700'
                }`}
              >
                Calendar
              </button>
              <button
                onClick={() => setActiveTab('rules')}
                className={`px-3 py-2 text-sm font-medium ${
                  activeTab === 'rules'
                    ? 'border-b-2 border-[#800000] text-[#800000]'
                    : 'hover:text-gray-700'
                }`}
              >
                Rules & Guidelines
              </button>
            </nav>
          </div>

          {/* Notification */}
          {notification && (
            <div
              className={`mt-4 p-4 rounded-md ${
                notification.type === 'error'
                  ? 'bg-red-50 text-red-800'
                  : 'bg-green-50 text-green-800'
              }`}
            >
              {notification.message}
            </div>
          )}

          {/* ROOMS TAB (Today) */}
          {activeTab === 'rooms' && (
            <div className="mt-4 space-y-8">
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                {rooms.map(room => {
                  const todaysRes = getRoomReservationsToday(room);
                  return (
                    <div key={room} className="rounded-md shadow p-4 bg-white">
                      <h2 className="text-lg font-bold mb-2">Room {room}</h2>
                      <div className="space-y-2">
                        {todaysRes.length === 0 ? (
                          <p className="text-sm text-gray-600">No reservations today</p>
                        ) : (
                          todaysRes.map(res => (
                            <div key={res.id} className="p-2 bg-gray-50 rounded-md text-sm mb-2">
                              Period {res.period} is reserved
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>

              <div className="rounded-md shadow p-4 bg-white">
                <h2 className="text-lg font-bold mb-4">Book a Room</h2>
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {/* Room */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Room</label>
                      <select
                        className="w-full border border-gray-300 rounded-md p-2"
                        value={formData.room}
                        onChange={(e) => handleChange('room', e.target.value)}
                      >
                        <option value="">Select room</option>
                        {rooms.map(r => (
                          <option key={r} value={r}>
                            Room {r}
                          </option>
                        ))}
                      </select>
                    </div>

                    {/* Date */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Date</label>
                      <input
                        type="date"
                        className="w-full border border-gray-300 rounded-md p-2"
                        value={formData.date}
                        onChange={(e) => handleChange('date', e.target.value)}
                        min={todayStr}
                        max={maxDateStr}
                      />
                    </div>

                    {/* Period */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Period (1-8)</label>
                      <select
                        className="w-full border border-gray-300 rounded-md p-2"
                        value={formData.period}
                        onChange={(e) => handleChange('period', e.target.value)}
                      >
                        {periods.map(per => (
                          <option key={per} value={per}>
                            Period {per}
                          </option>
                        ))}
                      </select>
                    </div>

                    {/* Name */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Name</label>
                      <input
                        type="text"
                        className="w-full border border-gray-300 rounded-md p-2"
                        placeholder="Your name"
                        value={formData.name}
                        onChange={(e) => handleChange('name', e.target.value)}
                      />
                    </div>

                    {/* Email */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Email (@rpsnj.us)</label>
                      <input
                        type="email"
                        className="w-full border border-gray-300 rounded-md p-2"
                        placeholder="your.email@rpsnj.us"
                        value={formData.email}
                        onChange={(e) => handleChange('email', e.target.value)}
                      />
                    </div>

                    {/* People */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium">Number of People (1-12)</label>
                      <select
                        className="w-full border border-gray-300 rounded-md p-2"
                        value={formData.people}
                        onChange={(e) => handleChange('people', e.target.value)}
                      >
                        {Array.from({ length: 12 }, (_, i) => (i + 1).toString()).map(num => (
                          <option key={num} value={num}>
                            {num} {num === '1' ? 'person' : 'people'}
                          </option>
                        ))}
                      </select>
                    </div>
                  </div>

                  <button
                    type="submit"
                    className={`w-full mt-4 p-2 rounded-md ${getPrimaryButtonStyle()}`}
                  >
                    Book Room
                  </button>
                </form>
              </div>
            </div>
          )}

          {/* MY RESERVATIONS */}
          {activeTab === 'myreservations' && (
            <div className="mt-4">
              <div className="rounded-md shadow p-4 bg-white">
                <h2 className="text-lg font-bold mb-4">My Current Reservations</h2>

                <div className="mb-4">
                  <label className="block text-sm font-medium mb-2">
                    Enter your @rpsnj.us email to view/cancel reservations
                  </label>
                  <input
                    type="email"
                    className="w-full border border-gray-300 rounded-md p-2"
                    placeholder="your.email@rpsnj.us"
                    value={formData.email}
                    onChange={(e) => handleChange('email', e.target.value)}
                  />
                </div>

                {formData.email.toLowerCase().endsWith('@rpsnj.us') ? (
                  <div className="space-y-4">
                    {myReservations().length === 0 ? (
                      <p className="text-gray-500 text-center py-4">
                        No reservations found for this email.
                      </p>
                    ) : (
                      myReservations().map(res => (
                        <div
                          key={res.id}
                          className="p-4 border border-gray-200 rounded-lg bg-gray-50 flex justify-between items-center"
                        >
                          <div>
                            <p className="font-medium">Room {res.room}</p>
                            <p className="text-sm">
                              Date: {res.date} | Period: {res.period}
                            </p>
                            <p className="text-sm">People: {res.people}</p>
                            <p className="text-sm mt-1">
                              Check-In Status: 
                              <button
                                className="ml-2 px-3 py-1 rounded-md bg-gray-300 cursor-default"
                                disabled
                              >
                                {res.checkedIn}
                              </button>
                            </p>
                          </div>
                          <button
                            onClick={() => cancelReservation(res.id)}
                            className={`px-4 py-2 rounded-md ${getPrimaryButtonStyle()}`}
                          >
                            Cancel
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                ) : (
                  <p className="text-gray-500 text-center py-4">
                    Please enter your @rpsnj.us email to view your reservations.
                  </p>
                )}
              </div>
            </div>
          )}

          {/* CALENDAR TAB (Weekly) */}
          {activeTab === 'calendar' && (
            <div className="mt-4 space-y-4">
              <div className="rounded-md shadow p-4 bg-white flex justify-between items-center">
                <button
                  onClick={prevWeek}
                  className={`px-3 py-1 rounded-md ${getPrimaryButtonStyle()}`}
                >
                  ‹ Prev
                </button>
                <h2 className="text-lg font-bold">
                  Week of {formatWeekStart(currentWeekStart)}
                </h2>
                <button
                  onClick={nextWeek}
                  className={`px-3 py-1 rounded-md ${getPrimaryButtonStyle()}`}
                >
                  Next ›
                </button>
              </div>

              <div className="rounded-md shadow overflow-x-auto bg-white">
                <table className="min-w-full border-collapse">
                  <thead>
                    <tr className="border-b border-gray-200">
                      <th className="p-2 text-left">Period \ Date</th>
                      {weekDates.map((d, idx) => (
                        <th key={idx} className="p-2 text-center">
                          {formatDayHeader(d)}
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {periods.map(p => (
                      <tr key={p} className="border-b border-gray-200">
                        <td className="p-2 font-medium text-center">Period {p}</td>
                        {weekDates.map((dayDate, colIdx) => {
                          const dayRes = getReservationsForDayAndPeriod(dayDate, p);
                          if (dayRes.length === 0) {
                            return (
                              <td key={colIdx} className="p-2 text-center text-gray-500">
                                –
                              </td>
                            );
                          }
                          return (
                            <td key={colIdx} className="p-2 text-center">
                              {dayRes.map(rObj => (
                                <div key={rObj.id} className="text-sm">
                                  Room {rObj.room}
                                </div>
                              ))}
                            </td>
                          );
                        })}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}

          {/* RULES TAB */}
          {activeTab === 'rules' && (
            <div className="mt-4 space-y-4">
              <div className="rounded-md shadow p-4 bg-white">
                <h2 className="text-lg font-bold">Conference Room Rules & Guidelines</h2>

                <div className="mt-4">
                  <h3 className="font-semibold mb-2">Attendance Policy</h3>
                  <p>
                    Reservations will be automatically cancelled if users do not arrive within
                    10 minutes of their period start time. After cancellation, the room becomes
                    available for immediate booking by other users.
                  </p>
                </div>

                <div className="mt-4">
                  <h3 className="font-semibold mb-2">Booking Guidelines</h3>
                  <ul className="list-disc pl-5 space-y-2">
                    <li>Reservations must be made using an @rpsnj.us email address</li>
                    <li>Rooms can accommodate 1–12 people</li>
                    <li>Users can book one period at a time</li>
                    <li>Please cancel reservations if you no longer need the room</li>
                    <li>Keep the room clean and organized for the next group</li>
                  </ul>
                </div>

                <div className="mt-4">
                  <h3 className="font-semibold mb-2">Room Usage</h3>
                  <ul className="list-disc pl-5 space-y-2">
                    <li>Maintain appropriate noise levels</li>
                    <li>Do not leave personal belongings unattended</li>
                    <li>Report any technical issues or damages immediately</li>
                    <li>No food or drinks allowed (water bottles excepted)</li>
                  </ul>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  ReactDOM.render(<ConferenceRoomSystem />, document.getElementById('root'));
</script>
</body>
</html>
